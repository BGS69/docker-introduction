<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Introduction to Docker - Catalyst Training</title>

        <meta name="author" content="Catalyst">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/catalyst.css" id="theme">
        <link rel="stylesheet" href="css/font-awesome.css">

        <!-- For syntax highlighting -->
        <!-- <link rel="stylesheet" href="lib/css/zenburn.css"> -->
        <link rel="stylesheet" href="lib/css/catalyst-syntax.css">

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement( 'link' );
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
                document.getElementsByTagName( 'head' )[0].appendChild( link );
            }
        </script>

        <style>
            /* Add the ability to omit slides from the printed version (has to be after the print include)*/
            @media print {
                .reveal .slides section.no-print {
                    display: none !important;
                    visibility: hidden !important;
                }
            }
        </style>
        <style>
            .reveal h1, .reveal h2, .reveal h3 {
                color: #ba2025;
            }
        </style>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->

        <!-- Please put any custom styles here -->
        <style>

        </style>
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <!-- Cover slide -->
                <section>
                    <h1 class="catalyst-logo">Catalyst</h1>
                    <h3>Intro to Docker</h3>
                    <p class="small-text">
                        Presented by <a href="#">Donovan Jones</a>
                    </p>
                </section>

                <section>
                    <h3>This course</h3>
                    <ul>
                        <li>Makes use of official docker docs</li>
                        <li>A mix of command line and theory</li>
                        <li>Assumes no prior docker knowledge</li>
                        <li>Assumes familiarity with the linux shell</li>
                        <li>Assumes we are using ubuntu (trusty)</li>
                        <li>Has some helper scripts</li>
                    </ul>
                </section>

                <section>
                    <h3>Aims</h3>
                    <ul>
                        <li>Understand how to use docker on the command line</li>
                        <li>Understand where docker can be used</li>
                        <li>Appreciation of the larger ecosystem</li>
                        <li>Get peole thinking about where they could use docker</li>
                        <li>Get people using the technology</li>
                    </ul>
                </section>

                <section>
                    <h3>Why docker?</h3>
                    <ul>
                        <li>Lightweight compared to traditional virtualization</li>
                        <li>Consistency across dev/test/prod</li>
                        <li>Easy to modify, update and scale</li>
                        <li>Portable</li>
                        <li>Dependency encapsulation and decoupling</li>
                        <li>Enables (requires?) new workflows</li>
                    </ul>
                </section>

                <!-- Large image slide -->
                <section class="image-slide">
                    <h2>Lightweight</h2>
                    <img src="img/docker.png" alt="">
                </section>

                <section>
                    <h3>Portability</h3>
                    <ul>
                        <li>Any modern Linux (RHEL, CentOS, Ubuntu LTS, etc.)</li>
                        <li>Lightweight Docker optimized Linux distributions (CoreOS, Project Atomic, RancherOS, etc.)</li>
                        <li>Private clouds (OpenStack, Vmware)</li>
                        <li>Public clouds (AWS, Azure, Rackspace, Google)</li>
                    </ul>
                </section>

                <section>
                    <h3>Decoupling</h3>
                    <ul>
                        <li>Application stack is no longer coupled to machine it is running on</li>
                        <li>Allows a service to have the most appropriate stack without needing to consider conflicts with and dependencies of other services (eg python versions)</li>
                        <li>Services can be run in the most optimal location for a given organisation</li>
                        <li>Services can be upgraded and scaled independently</li>
                        <li>Services boundaries can define areas of responsibility</li>
                        <li>Configuration is coupled with the application</li>
                        <li>Service vs. Machine</li>
                    </ul>
                </section>

                <section>
                    <h3>Containers and Images</h3>
                    <ul>
                        <li>Images</li>
                            <ul>
                                <li>Read only template for creating containers</li>
                                <li>Stored in a registry</li>
                                <li>Built by you or others</li>
                            </ul>
                        <li>Containers</li>
                            <ul>
                                <li>Based on an image</li>
                                <li>An actual running instance</li>
                                <li>Read write</li>
                                <li>Encasulates your application and its dependencies</li>
                            </ul>
                    </ul>
                </section>

                <!-- Large image slide -->
                <section class="image-slide">
                    <h2>Containers and Images</h2>
                    <img src="http://alandargan.com/wp-content/uploads/2014/11/Docker2.png" alt="">
                </section>

                <section>
                    <h3>Understanding docker</h3>
                    <p><a href="https://docs.docker.com/introduction/understanding-docker/">https://docs.docker.com/introduction/understanding-docker/</a> <a href="http://webcache.googleusercontent.com/search?q=cache:https://docs.docker.com/introduction/understanding-docker/">(cache)</a></p>
                </section>

                <!-- Large image slide -->
                <section class="image-slide">
                    <h2>Simple Workflow</h2>
                    <img src="http://blog.octo.com/wp-content/uploads/2014/01/Diapositive1.png" alt="">
                </section>

                <section>
                    <h3>Scripts</h3>
                    <ul>
                        <li>Designed to be run on trusty training machines</li>
                        <li>docker-setup.sh - ensures required software is installed</li>
                        <li>user-setup.sh - sets up environment variables for our user</li>
                        <li>docker-course.sh - list or run the course commands</li>
                    </ul>
                </section>

                <section>
                    <h3>Setup</h3>
                    <p>lets setup our environment now</p>
                    <pre><code data-trim contenteditable>
cd docker-training
source ./user-setup.sh
                    </code></pre>
                </section>

                <section>
                    <h3>Course script</h3>
                    <p>By default this script outputs all the commands you will need to run</p>
                    <pre><code data-trim contenteditable>
$ sudo ./docker-course.sh -h

Usage: sudo ./docker-course.sh [OPTIONS]

    -h        this help
    -s        takes an integer, indicates that we should stop at this section
    -r        replay, runs all the commands without user input
    -i        interactive replay, requires keypresses to run commands
                    </code></pre>
                    <p>try it now</p>
                    <pre><code data-trim contenteditable>
sudo ./docker-course.sh -s 3
                    </code></pre>
                </section>

                <section>
                    <h3>1: Dockerizing applications</h3>
<a href="https://docs.docker.com/userguide/dockerizing/">https://docs.docker.com/userguide/dockerizing</a> <a href="http://webcache.googleusercontent.com/search?q=cache:https://docs.docker.com/userguide/dockerizing">(cache)</a>
                </section>

                <section>
                    <h3>2: Working with containers</h3>
<a href="https://docs.docker.com/userguide/usingdocker">https://docs.docker.com/userguide/usingdocker</a> <a href="http://webcache.googleusercontent.com/search?q=cache:https://docs.docker.com/userguide/usingdocker">(cache)</a>
                </section>

                <section>
                    <h3>3: Get started with images</h3>
<a href="https://docs.docker.com/userguide/dockerimages">https://docs.docker.com/userguide/dockerimages</a> <a href="http://webcache.googleusercontent.com/search?q=cache:https://docs.docker.com/userguide/dockerimages">(cache)</a>
                </section>

                <section>
                    <h3>4: Networking containers</h3>
<a href="https://docs.docker.com/engine/userguide/networkingcontainers/">https://docs.docker.com/engine/userguide/networkingcontainers/</a> (new in 1.9 was <a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/">dockerlinks</a>)
                </section>

                <section>
                    <h3>5: Managing data in containers</h3>
<a href="https://docs.docker.com/userguide/dockervolumes">https://docs.docker.com/userguide/dockervolumes</a> <a href="http://webcache.googleusercontent.com/search?q=cache:https://docs.docker.com/userguide/dockervolumes">(cache)</a>
                </section>

                <section>
                    <h3>6: Get started with Docker Hub</h3>
<a href="https://docs.docker.com/userguide/dockerrepos">https://docs.docker.com/userguide/dockerrepos</a> <a href="http://webcache.googleusercontent.com/search?q=cache:https://docs.docker.com/userguide/dockerrepos">(cache)</a>
                </section>

                <section>
                <!-- Large image slide -->
                <section class="image-slide">
                    <h2>7: Layering (via a Union file system)</h2>
                    <img src="https://assets.digitalocean.com/articles/docker_ecosystem/Container-Overview.png" alt="">
                </section>
                <section>
                    <h3>7: Layers</h3>
                    <ul>
                        <li>dockviz</li>
                    <pre><code data-trim contenteditable>
sudo dockviz images --tree

sudo dockviz images -d | dot -Tpng -o images.png && eog images.png && rm images.png
sudo dockviz containers -d | dot -Tpng -o containers.png && eog containers.png && rm containers.png
                    </code></pre>
                    </ul>
                </section>

                <section>
                    <h3>7: imagelayers.io</h3>
                    <p><a href="https://imagelayers.io/">https://imagelayers.io/</a><p>
                </section>

                <section>
                    <h3>7: Docker history</h3>
                    <p>Show the history (layers) of an image</p>
                    <pre><code data-trim contenteditable>
$ docker history cb7ea125b1fc
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
cb7ea125b1fc        3 months ago        /bin/sh -c gem install sinatra                  18.44 MB
0c0869a12bcd        3 months ago        /bin/sh -c apt-get update && apt-get install    112.7 MB
6d4946999d4f        3 months ago        /bin/sh -c #(nop) CMD ["/bin/bash"]             0 B
9fd3c8c9af32        3 months ago        /bin/sh -c sed -i 's/^#\s*\(deb.*universe\)$/   1.895 kB
435050075b3f        3 months ago        /bin/sh -c echo '#!/bin/sh' > /usr/sbin/polic   194.5 kB
428b411c28f0        3 months ago        /bin/sh -c #(nop) ADD file:b3447f4503091bb6bb   188.1 MB
                    </code></pre>
                </section>

                <section>
                    <h3>7: Docker Diff</h3>
                    <p>Show the differences between a container's filesystem and its base image</p>
                    <pre><code data-trim contenteditable>
$ sudo docker run --name=sleepy_cori -it ubuntu:latest /bin/bash
root@e888e0fef39e:/# echo flubber > test.txt
root@e888e0fef39e:/# exit

$ sudo docker ps -l
CONTAINER ID IMAGE         COMMAND     CREATED        STATUS                    PORTS NAMES
e888e0fef39e ubuntu:latest "/bin/bash" 57 seconds ago Exited (0) 11 seconds ago       sleepy_cori

$ sudo docker restart sleepy_cori
sleepy_cori

$ sudo docker attach sleepy_cori
root@e888e0fef39e:/# 
                    </code></pre>
                </section>

                <section>
                    <h3>7: Docker Diff</h3>
                    <pre><code data-trim contenteditable>
root@e888e0fef39e:/# apt-get install mtr-tiny
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
mtr-tiny
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 41.7 kB of archives.
After this operation, 126 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu/ trusty/main mtr-tiny amd64 0.85-2 [41.7 kB]
Fetched 41.7 kB in 1s (38.4 kB/s)
Selecting previously unselected package mtr-tiny.
(Reading database ... 11528 files and directories currently installed.)
Preparing to unpack .../mtr-tiny_0.85-2_amd64.deb ...
Unpacking mtr-tiny (0.85-2) ...
Setting up mtr-tiny (0.85-2) ...
root@e888e0fef39e:/# exit
                    </code></pre>
                </section>

                <section>
                    <h3>7: Docker Diff</h3>
                    <pre><code data-trim contenteditable>
$ sudo docker ps -l
CONTAINER ID IMAGE         COMMAND     CREATED       STATUS                    PORTS NAMES
e888e0fef39e ubuntu:latest "/bin/bash" 2 minutes ago Exited (0) 25 seconds ago       sleepy_cori

$ sudo docker diff sleepy_cori | head
C /root
A /root/.bash_history
A /test.txt
C /tmp
C /usr
C /usr/bin
A /usr/bin/mtr
C /usr/share
C /usr/share/doc
A /usr/share/doc/mtr-tiny
                    </code></pre>
                </section>

                <section>
                    <h3>7: Docker Diff</h3>
                    <p>Show the differences between a container's filesystem and its base image</p>
                    <pre><code data-trim contenteditable>
$ sudo find /var/lib/docker/ -type f -name 'test.txt' -exec md5sum {} \;
185320c3e9298cdbde3320ec32144980  /var/lib/docker/aufs/diff/e888e0fef39e6f7f249f33f0475e891aaef899cca9ed0ea39d2524e5f06be792/test.txt

$ sudo docker restart sleepy_cori
sleepy_cori

$ sudo docker exec sleepy_cori md5sum test.txt
185320c3e9298cdbde3320ec32144980  test.txt
                    </code></pre>
                </section>

                <section>
                    <h3>7: Docker Diff what is AUFS?</h3>
                    <ul>
                        <li>Did you notice /var/lib/docker/aufs?</li>
                        <li><a href="http://aufs.sourceforge.net/">Advanced Multi Layered Unification Filesystem</a></li>
                    <pre><code data-trim contenteditable>
priority = []string{
"aufs",
"btrfs",
"devicemapper",
"vfs",
"overlayfs",
                    </code></pre>
                        <li>Details <a href="https://developerblog.redhat.com/2014/09/30/overview-storage-scalability-docker/">here</a></li>
                    </ul>
                </section>


                </section>

                <section>
                <section>
                    <h3>8: More on Dockerfiles</h3>
                    <ul>
                        <li><a href="https://docs.docker.com/articles/dockerfile_best-practices/">Dockerfile Best Practices</a></li>
                        <li><a href="https://github.com/nginxinc/docker-nginx/blob/4e5332fa50a1f8f73657417c6bfe249bbb3b110d/Dockerfile">Nginx Dockerfile</a></li>
                        <li><a href="https://github.com/docker-library/postgres/blob/8a9fbcb40f13ccc7762f278b9df611cabe22d300/9.5/Dockerfile">Postgres Dockerfile</a></li>
                        <li><a href="https://labs.ctl.io/dockerfile-entrypoint-vs-cmd/">ENTRYPOINT vs CMD</a></li>
                    </ul>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <ul>
                        <li>See <a href="https://labs.ctl.io/dockerfile-entrypoint-vs-cmd/">https://labs.ctl.io/dockerfile-entrypoint-vs-cmd/</a> for details</li>
                        <li>Lets look at some images: <a href="https://imagelayers.io/?images=debian:latest,ubuntu:latest,alpine:latest">https://imagelayers.io/?images=debian:latest,ubuntu:latest,alpine:latest</a></li>
                    <pre><code data-trim contenteditable>
$ sudo docker run -i -t debian
root@0f94a65e7d37:/# exit
$ sudo docker run -i -t alpine
Error response from daemon: No command specified
                    </code></pre>
                    </ul>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <pre><code data-trim contenteditable>
$ cat dockerfiles/ping-localhost/Dockerfile
FROM debian:jessie
CMD ping localhost
$ sudo docker build -t demo dockerfiles/ping-localhost
$ sudo docker run -t demo
PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.034 ms
64 bytes from localhost (127.0.0.1): icmp_seq=2 ttl=64 time=0.054 ms
64 bytes from localhost (127.0.0.1): icmp_seq=3 ttl=64 time=0.064 ms
$ docker run demo uname -a
Linux fac4960db319 3.13.0-66-generic #108-Ubuntu SMP Wed Oct 7 15:20:27 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
                    </code></pre>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <ul>
                        <li>Use CMD when you want the user to have the choice of commands to run</li>
                        <li>Use ENTRYPOINT when you want to wrap a command</li>
                        <li>ENTRYPOINT can be overridden with the --entrypoint flag</li>
                    </ul>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <pre><code data-trim contenteditable>
$ cat dockerfiles/python/Dockerfile
FROM python
ENTRYPOINT ["python"]
$ sudo docker build -t python dockerfiles/python
Sending build context to Docker daemon 2.048 kB
Step 0 : FROM python
---> e7d942e7369d
Step 1 : ENTRYPOINT python
---> Using cache
---> c3b6fc104517
Successfully built c3b6fc104517
$ sudo docker run -ti python
Python 3.5.0 (default, Nov 11 2015, 10:39:25)
[GCC 4.9.2] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> exit()
$ sudo docker run --entrypoint uname -t python
Linux
                    </code></pre>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <pre><code data-trim contenteditable>
$ sudo docker run -d demo
f27197f4370c2981792ab3d09a0620c1c8f7c993cb66770ffc1f1aa6c4dfe021
$ docker ps -l
CONTAINER ID IMAGE     COMMAND                 CREATED        STATUS         PORTS NAMES
f27197f4370c dojo/demo "/bin/sh -c 'ping loc"  11 seconds ago Up 10 seconds        suspicious_leakey
$ sudo docker exec f27197f4370c ps -f
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 08:21 ?        00:00:00 /bin/sh -c ping localhost
root         5     1  0 08:21 ?        00:00:00 ping localhost
root         6     0  0 08:21 ?        00:00:00 ps -f
                    </code></pre>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <ul>
                        <li>Shell form vs Exec form</li>
                        <li>Don't mix and match</li>
                        <li>Use exec</li>
                    </ul>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <pre><code data-trim contenteditable>
$ cat dockerfiles/ping-localhost-exec/Dockerfile
FROM debian:jessie
CMD ["ping", "localhost"]
$ sudo docker build -t demo dockerfiles/ping-localhost-exec/
...
$ sudo docker run -d demo
db7526643dbe7ec6d6f27aa707539aa67a3573a8adc7754372d8fce0fe824cfc
$ sudo docker exec db7526643dbe ps -f
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 08:27 ?        00:00:00 ping localhost
root         6     0  0 08:27 ?        00:00:00 ps -f
                    </code></pre>
                </section>
                <section>
                    <h3>8: Dockerfiles: ENTRYPOINT vs CMD</h3>
                    <pre><code data-trim contenteditable>
$ cat dockerfiles/ping-localhost-both/Dockerfile
FROM debian:jessie
ENTRYPOINT ["/bin/ping","-c","3"]
CMD ["localhost"]
$ sudo docker build -t ping dockerfiles/ping-localhost-both
$ sudo docker run ping google.com
$ sudo docker run ping
                    </code></pre>
                </section>
                </section>

                <section>
                    <h3>9: Base images</h3>
                    <ul>
                        <li>Size is a major consideration ... deploy times ...</li>
                        <li>FROM empty ...</li>
                        <li><a href="http://www.busybox.net/">Busybox</a> - 5.6 MB, no package manager</li>
                        <li><a href="https://www.alpinelinux.org/">Alpine Linux</a> - distribution of choice for minimal containers - 5MB with a package manager</li>
                        <li><a href="https://hub.docker.com/_/debian/">Debian</a> - Reccomended by Docker, smaller than Ubuntu - 85MB</li>
                        <li><a href="https://hub.docker.com/_/ubuntu/">Ubuntu</a> - Commonly used but quite big</li>
                        <li>Language images (<a href="https://hub.docker.com/_/golang/">golang</a>, <a href="https://hub.docker.com/_/python/">python</a> etc.) - Seem to be mostly based on Debian</li>
                        <li>See <a href="http://www.blang.io/2015/04/18/how-to-build-the-smallest-docker-containers.html">1</a>, <a href="http://www.livewyer.com/blog/2015/02/24/slimming-down-your-docker-containers-alpine-linux">2</a>, <a href="https://docs.docker.com/articles/baseimages/">3</a></li>
                    </ul>
                </section>

                <section>
                <section>
                    <h3>10: Docker networking</h3>
                    <img src="http://www.linuxjournal.com/files/linuxjournal.com/ufiles/imagecache/large-550px-centered/u1002061/11833f1.png" alt="Docker networking">
                </section>

                <section>
                    <h3>10: Docker networking</h3>
                    <ul>
                        <li>docker0 virtual bridge</li>
                        <li>172.17.42.1/16 by default</li>
                        <li>Part of the 172.16.0.0/12 RFC 1918 space</li>
                        <li>Sets up virtual ether net ports on the host (eg veth31a763b)</li>
                        <li>Sets up a Docker Chain in iptables</li>
                        <li>Mounts hosts /etc/resolv.conf and /etc/hosts</li>
                    </ul>
                </section>
                <section>
                    <h3>10: Docker networking</h3>
                    <pre><code data-trim contenteditable>
# try these commands your the host
# use your own container name
$ sudo iptables -L
$ sudo ip addr
$ sudo docker exec -it stoic_ramanujan findmnt
$ sudo cat $(sudo docker exec -it stoic_ramanujan findmnt | grep resolv | awk -F'[][]' '{ print $2 }')
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 192.168.2.92
search wgtn.cat-it.co.nz lan
                    </code></pre>
                </section>
                </section>

                <section>
                <section>
                    <h3>11: Exec vs Attach</h3>
                    <ul>
                        <li>Exec is specifically for running new processes in an already started container, be it a shell or some other process</li>
                        <li>Attach is for attaching to the running process, not for running an extra process in a container</li>
                    </ul>
                </section>
                <section>
                    <h3>11: Exec</h3>
                    <ul>
                        <li>The docker exec command runs a <strong>new</strong> command (process) in a running container</li>
                    </ul>
                </section>
                <section>
                    <h3>11: Attach</h3>
                    <ul>
                        <li>Attach lets you view or interact with any running container's primary process (pid 1) </li>
                        <li>You can attach to the same contained process multiple times simultaneously, screen sharing style</li>
                        <li>View the output of your daemonized process</li>
                        <li>Not for running a new process in a container</li>
                    </ul>
                </section>
                </section>

                <section>
                    <h3>Some Concepts</h3>
                    <ul>
                        <li>Buzzwords ahead!</li>
                        <li><a href="http://radar.oreilly.com/2015/06/an-introduction-to-immutable-infrastructure.html">Immutable infrastructure</a></li>
                        <li><a href="https://blog.engineyard.com/2014/pets-vs-cattle">Cattle vs pets</a></li>
                        <li><a href="http://martinfowler.com/bliki/SnowflakeServer.html">Snowflake Servers</a> vs. <a href="http://martinfowler.com/bliki/PhoenixServer.html">Phoenix Servers</a></li>
                    </ul>
                </section>

                <!-- Immutable Infrastructure -->
                <section>
                <section>
                    <h3>Immutable Architecture/Infrastructure</h3>
                    <ul>
                        <li>Phoenix servers</li>
                        <li>The environment is defined in code</li>
                        <li>If you need to change _anything_ you create a new instance and destroy the old one</li>
                        <li>Docker makes it much more likely you will work in this way</li>
                        <li>Procedural vs Declarative</li>
                    </ul>
                </section>
                <!-- Large image slide -->
                <section class="image-slide">
                    <h2>Immutable Architecture</h2>
                    <img src="http://s.radar.oreilly.com/wp-files/2/2015/06/immutable_infrastructure.gif" alt="Immutable Architecture" height="600" width="800">
                </section>
                </section>

                <!-- Microservices -->
                <section>
                <section>
                    <h3>Microservices</h3>
                    <p>Cockcrofts definition: Loosely coupled service oriented architecture with bounded contexts</p>
                    <p>Eric Brewers: Microservice boundaries are language boundaries and team boundaries</p>
                </section>
                <section>
                    <h3>Microservices</h3>
                    <ul>
                        <li>A suite of small services, each running in its own process and communicating with lightweight mechanisms</li>
                        <li>Services can be implemented with entirely different stacks</li>
                        <li>Services can be developed, maintained, and updated independently</li>
                        <li>Often use well defined REST APIs to communicate</li>
                        <li>If a message bus is used then its likely to be lightweight (ZeroMQ vs ESB)</li>
                    </ul>
                </section>
                <section>
                    <h3>Microservices</h3>
                    <ul>
                        <li>Often use a DevOps approach (you build it you run it)</li>
                        <li>Smart endpoints and dumb pipes</li>
                        <li>Decentralized Data Management with eventual consistency</li>
                        <li>Continuous integration and delivery</li>
                        <li>Design for failure (optimize MTTR)</li>
                    </ul>
                </section>
                <section>
                    <h3><a href="https://www.nginx.com/blog/microservices-at-netflix-architectural-best-practices/">Microservices best practices</a></h3>
                    <ul>
                        <li>Create a Separate Data Store for Each Microservice</li>
                        <li>Keep Code at a Similar Level of Maturity</li>
                        <li>Do a Separate Build for Each Microservice</li>
                        <li>Deploy in Containers</li>
                        <li>Treat Servers as Stateless</li>
                    </ul>
                </section>
                <section>
                    <h3>Containers and Microservices</h3>
                    <ul>
                        <li>Containers do not necessarily map to service or application boundaries</li>
                        <li>A service will often contain more than one container</li>
                        <li>A container is more like an OO Class - Brendan Burns @ Dockercon 2015</li>
                        <li>A container is a persistent object - Eric Brewer @ OSCon 2015</li>
                    </ul>
                </section>
                <section>
                    <h3>Containers and Microservices: Requirements</h3>
                    <ul>
                        <li>Sharing among containers (eg filesystems)</li>
                        <li>Atomic co-scheduling of containers</li>
                        <li>Parameterization of containers</li>
                    </ul>
                </section>
                <section>
                    <h3>Microservices - Resources</h3>
                    <ul>
                        <li><a href="http://martinfowler.com/articles/microservices.html">Microservices - Martin Fowler</a></li>
                        <li><a href="https://www.nginx.com/blog/microservices-at-netflix-architectural-best-practices/">Adopting Microservices at Netflix: Lessons for Architectural Design</a></li>
                        <li><a href="https://www.nginx.com/blog/adopting-microservices-at-netflix-lessons-for-team-and-process-design/">Adopting Microservices at Netflix: Lessons for Team and Process Design</a></li>
                        <li><a href="https://www.youtube.com/watch?v=e4jr6Ihz4Qo">Kubernetes: The Path to Cloud Native - Eric Brewer - OSCon 2105</a></li>
                        <li>Nginx blog Building Microservices series: <a href="https://www.nginx.com/blog/introduction-to-microservices/">1</a>,<a href="https://www.nginx.com/blog/building-microservices-using-an-api-gateway">2</a>,<a href="https://www.nginx.com/blog/building-microservices-inter-process-communication/">3</a></li>
                        <li><a href="https://www.nginx.com/blog/microservices-at-netflix-architectural-best-practices/">Microservices best practices</a></li>
                    </ul>
                </section>
                </section>

                <section>
                    <h3>Devops</h3>
                    <ul>
                        <li>You build it you run it</li>
                        <li>With docker it is easier to make a distinction between who "owns" the service and who "owns" the platform the service runs on</li>
                        <li>Because dev is like production the developer thinks about how it runs in production</li>
                    </ul>
                </section>

                 <!-- Continuous delivery -->
                <section>
                <section>
                    <h3>Continuous delivery</h3>
                    <ul>
                        <li>Automated Pipeline from developer commit to production deploy</li>
                        <li>Requires Continuous Integration where every commit triggers all the tests</li>
                        <li>Requires lots of tests</li>
                    </ul>
                </section>
                <section>
                    <h3>Continuous delivery antipatterns</h3>
                    <ul>
                        <li>Deploying software manually</li>
                        <li>Deploying to a production-like environment only after development is complete</li>
                        <li>Manual configuration of production environments</li>
                        <li>Docker makes it difficult to do any of these</li>
                    </ul>
                </section>
                </section>

                 <!-- Where to start? -->
                <section>
                <section>
                    <h3>Containers: Where to start?</h3>
                    <ul>
                        <li>Building binaries</li>
                        <li>Prototypes you can share</li>
                        <li>Tutorials</li>
                        <li>Those small snowflakes</li>
                        <li>Build new functionality as microservices</li>
                        <li>Existing components that are already largely independent</li>
                        <li>Mix and match, containerise the bits that make sense</li>
                    </ul>
                </section>
                <section>
                    <h3>Examples</h3>
                    <ul>
                        <li><a href="https://blog.docker.com/2015/07/docker-three-ways-devops-3/">Distributing (scientific) data</a></li>
                        <li><a href="https://github.com/VISIONAI/clouddream">Distributing clouddream</a></li>
                        <li><a href="https://github.com/CenturyLinkLabs/golang-builder">Compiling go</a></li>
                    </ul>
                </section>
                 <!-- Large image slide -->
                <section class="image-slide">
                    <h2>Bosch Dreaming</h2>
                    <a href="img/Hieronymus_Bosch_003.jpg"><img src="img/Hieronymus_Bosch_003.jpg" alt="Bosch Dream" height="600" width="800"></a>
                </section>
                </section>

                <!-- ecosystem -->
                <section>
                <section>
                    <h3>Docker ecosystem</h3>
                    <ul>
                        <li>An explosion of tools</li>
                        <li>Hard to keep up</li>
                        <li>Lets have a quick look</li>
                    </ul>
                </section>
                <!-- Large image slide -->
                <section class="image-slide">
                    <h2>Docker ecosystem</h2>
                    <img src="img/docker-ecosystem.png" alt="Docker Ecosystem" height="600" width="800">
                </section>
                <section>
                    <h3>The stack</h3>
                    <ul>
                        <li>The LAMP stack equivalent</li>
                        <li>Container Orchestration Engines</li>
                        <li>Linux - Docker - COE - ?</li>
                        <li>Often LDK</li>
                        <li>Higher level projects build on this stack (eg OpenShift and CloudFoundry)</li>
                    </ul>
                </section>
                <section>
                    <h3>Docker ecosystem - Host OS</h3>
                    <p>Lightweight operating systems designed to run containers</p>
                    <ul>
                        <li><a href="https://coreos.com/">CoreOS</a> (systemd)</li>
                        <li><a href="http://www.projectatomic.io/">Project Atomic</a> (cut down RHEL)</li>
                        <li><a href="http://rancher.com/">Rancher</a> (Dockers all the way down)</li>
                        <li><a href="http://boot2docker.io/">boot2docker</a> (for windows/mac devs)</li>
                    </ul>
                </section>
                <section>
                    <h3>Docker ecosystem - Container Orchestration Engines</h3>
                    <p>Engine for orchestrating container workloads, term comes from the OpenStack Magnum project.</p>
                    <ul>
                        <li>Docker Compose</li>
                        <li>Docker Swarm</li>
                        <li>Kubernetes</li>
                        <li>Apache Mesos</li>
                    </ul>
                </section>
                </section>

                <!-- Docker compose -->
                <section>
                <section>
                    <h3>Docker compose</h3>
                    <ul>
                        <li>Written in python rather than go like most of docker</li>
                        <li>Comparable to vagrant</li>
                        <li>New lib written in go called <a href="http://rancher.com/our-journey-with-docker-compose-and-the-introduction-of-libcompose/">libcompose</a></li>
                    </ul>

                </section>
                <section>
                    <h3>Docker compose</h3>
                    <a href="https://docs.docker.com/compose/">Overview of Docker Compose</a> <a href="http://webcache.googleusercontent.com/search?q=cache:https://docs.docker.com/compose/">(cache)</a>
                </section>
                <section>
                    <h3>Docker compose - hands on</h3>
                    <a href="https://docs.docker.com/compose/gettingstarted/">Example app</a>
                </section>
                </section>

                <!-- Docker swarm -->
                <section>
                    <h3>Docker swarm</h3>
                    <ul>
                        <li>Native clustering for Docker</li>
                        <li>Use standard tools to interact with a cluster of docker engines</li>
                        <li>Turn a group of Docker engines into a single, virtual Docker engine</li>
                        <li>Engines can be deployed using docker machine (<a href="http://docs.catalystcloud.io/tutorials.html#create-an-a-cloud-vm-using-docker-machine">example</a>)</li>
                    </ul>
                </section>

                <!-- Kubernetes -->
                <section>
                <section>
                    <h3>Kubernetes</h3>
                    <ul>
                        <li>Container orchestrator</li>
                        <li>Started by Google</li>
                        <li>Inspired by Borg</li>
                        <li>Open source project written in Go</li>
                        <li>Cloud Native Computing Foundation</li>
                        <li>Manage applications not machines</li>
                    </ul>
                </section>
                <section>
                    <h3><a href="http://blog.arungupta.me/kubernetes-design-patterns/">Pods</a></h3>
                    <ul>
                        <li>Co-locate containers</li>
                        <li>Shared volumes</li>
                        <li>IP address (important for port space and migration)</li>
                        <li>Unit of deployment and migration</li>
                        <li>Easy migration = high utilisation</li>
                        <li>Scale service by scaling pods</li>
                    </ul>
                </section>
                </section>

                <section>
                    <h3>Patterns for Composite Containers</h3>
                    <a href="http://blog.kubernetes.io/2015/06/the-distributed-system-toolkit-patterns.html">http://blog.kubernetes.io/2015/06/the-distributed-system-toolkit-patterns.html</a>
                    <ul>
                        <li>Sidecar containers (eg logger, git synchroniser)</li>
                        <li>Ambassador containers (local proxy to a service of unknown size)</li>
                        <li>Adapter containers (normalize and abstract different services)</li>
                    </ul>
                </section>

                 <!-- Managing state -->
                <section>
                <section class="image-slide">
                    <h2>Managing state - CAP</h2>
                    <p>Managing state can be tricky</p>
                    <img src="http://digbigdata.com/wp-content/uploads/2013/05/media_httpfarm5static_mevIk.png" alt="CAP" height="600" width="800">
                </section>
                <section>
                    <h3>Managing State</h3>
                    <p>"In a cluster of ephemeral containers application state must exist outside of the containers."</p>
                    <p>Ian Lewis, Google - <a href="https://speakerdeck.com/ianlewis/in-a-world-of-ephemeral-containers-how-do-we-keep-track-of-things-at-openstack-summit-tokyo">In a World of Ephemeral Containers, How Do We Keep Track of Things? @ OpenStack Summit Tokyo</a> (<a href="https://www.youtube.com/watch?v=aYs7IxMQzgg">video</a>)</p>
                </section>
                <section>
                    <h3>Managing State</h3>
                    <ul>
                        <li>Normal Docker volumes are per host</li>
                        <li>Kubernetes Persistent volumes</li>
                        <li>Docker Engine 1.9 includes redesigned volume system with more plugins (eg <a href="https://docs.clusterhq.com/en/1.7.1/introduction/what-is-flocker.html">Flocker</a>)</li>
                    </ul>
                </section>
                <section>
                    <h3>Patterns for Managing State</h3>
                    <ul>
                        <li>Outside the cluster (SEP)</li>
                        <li>Adapted to run in cluster (eg MySQL inside cluster)</li>
                        <li>Cluster native (eg Cassandra or Riak)</li>
                        <li><a href="http://vitess.io/">vitess.io</a></li>
                    </ul>
                </section>
                </section>

                <!-- Security -->
                <section>
                <section>
                    <h3>Security</h3>
                    <ul>
                        <li>How do you keep track of all the versions of all the software in all the containers?</li>
                        <li>The way to apply security updates is to update the base image, then rebuild your application image</li>
                        <li>If you release often then include an updated base every time you release (plus special releases for heartbleeds)</li>
                        <li>If you release infrequently then do base update releases of your app</li>
                    </ul>
                </section>
                <section>
                    <h3>Security - Image Signing</h3>
                    <ul>
                        <li><a href="https://blog.docker.com/2015/08/content-trust-docker-1-8/">Intoduction to Docker Content Trust</a></li>
                        <li>Provided by the <a href="https://github.com/docker/notary">Notary</a> open source project</li>
                        <li>Based on <a href="http://theupdateframework.com/">The Update Framework</a></li>
                        <li><a href="https://www.youtube.com/watch?v=at72dhg-SZY&feature=youtu.be&t=4873">Video</a></li>
                        <li><a href="https://docs.docker.com/engine/security/trust/content_trust/">Content Trust Documentation</a></li>
                    </ul>
                </section>
                <section>
                    <h3>Security - Image Vulnerability Scanning</h3>
                    <ul>
                        <li><a href="https://coreos.com/blog/vulnerability-analysis-for-containers/">Intoduction to Clair from CoreOS</a></li>
                        <li><a href="https://github.com/coreos/clair">Clair on github</a></li>
                        <li>Project Nautilus a new image scanning and vulnerability detection service for Official Repos on Docker Hub</li>
                    </ul>
                </section>
                <section>
                    <h3>Security - Useful links</h3>
                    <ul>
                        <li>How often do the official base images get updated? (details <a href="https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/">here</a>)</li>
                        <li><a href="https://titanous.com/posts/docker-insecurity">Image signing</a> (see <a href="https://github.com/docker/notary">notary</a>)</li>
                        <li><a href="https://securityblog.redhat.com/2014/12/17/container-security-isolation-heaven-or-dependency-hell/">Level of isolation</a></li>
                        <li><a href="https://d3oypxn00j2a10.cloudfront.net/assets/img/Docker%20Security/WP_Intro_to_container_security_03.20.2015.pdf">Introduction to Container Security</a> Whitepaper</li>
                        <li><a href="https://blog.docker.com/2013/08/containers-docker-how-secure-are-they/">Fundamentals</a> (old but informative)</li>
                        <li><a href="http://linux-audit.com/docker-security-best-practices-for-your-vessel-and-containers/">Best practices</a></li>
                    </ul>
                </section>
                <section>
                    <h3>Other problems</h3>
                    <ul>
                        <li>Not declarative</li>
                        <li>Not idempotent or repeatable</li>
                        <li>Pids and spawning issues</li>
                        <li>Standardisation</li>
                        <li>See <a href="https://www.youtube.com/watch?v=wpFrkq5XNFM">these</a> <a href="https://www.youtube.com/watch?v=et7BCV_kAUY">talks</a> from systemd.conf</li>
                    </ul>
                </section>
                </section>

                <section>
                <section>
                    <h3>Monitoring</h3>
                    <p>Q: How can i monitor my containers?</p>
                    <p>A: Try sysdig/csysdig</p>
                    <ul>
                        <li>sudo csysdig</li>
                        <li>hit F2 and choose the Containers view</li>
                        <li>can also monitor <a href="http://blog.kubernetes.io/2015/11/monitoring-Kubernetes-with-Sysdig.html">kubernetes</a></li>
                    </ul>
                </section>
                <section>
                    <h3>Monitoring</h3>
                    <p>Lets build a docker image for some testing:</p>
                    <pre><code data-trim contenteditable>
$ cat ~/src/docker-training/dockerfiles/stress-testing/Dockerfile
$ sudo docker build -t stress-test ~/src/docker-training/dockerfiles/stress-testing/
$ sudo docker run stress-test stress --help
$ sudo docker run [DOCKER OPTIONS] stress-test stress [STRESS OPTIONS]
                    </code></pre>
                </section>
                <section>
                    <h3>Monitoring and CPU limits</h3>
                    <p>Run this command while watching csysdig and htop in other terminals</p>
                    <pre><code data-trim contenteditable>
$ sudo docker run --cpuset-cpus=0,1 stress-test stress -c 3
# in another terminal
$ sudo csysdig
# in another terminal
$ sudo htop
                    </code></pre>
                </section>
                <section>
                    <h3>Monitoring and Memory limits</h3>
                    <p>Run this command while watching csysdig and htop in other terminals</p>
                    <pre><code data-trim contenteditable>
$ sudo docker run -m 512M stress-test stress --vm-bytes 256M -m 4
# in another terminal
$ sudo csysdig
# in another terminal
$ sudo htop
                    </code></pre>
                </section>
                <section>
                    <h3>Monitoring - check-config</h3>
                    <p>How to enable limiting swap:</p>
                    <pre><code data-trim contenteditable>
$ check-config.sh
# GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1"
                    </code></pre>
                </section>
                </section>

                <section>
                <section>
                    <h3>FAQ</h3>
                    <ul>
                        <li><a href="http://www.projectatomic.io/blog/2015/08/why-we-dont-let-non-root-users-run-docker-in-centos-fedora-or-rhel/">Why is sudo required?</a></li>
                        <li><a href="http://www.projectatomic.io/blog/2015/07/what-are-docker-none-none-images/">What are the &lt;none&gt;&lt;none&gt; images I see and how can I clean them up?</a></li>
                        <li><a href="https://docs.docker.com/articles/baseimages/">Can I build my own base image?</a></li>
                        <li><a href="https://stackoverflow.com/questions/24394243/why-are-docker-container-images-so-large">Why are Docker images so large?</a></li>
                        <li><a href="http://thenewstack.io/understanding-the-docker-cache-for-faster-builds/">Does each Dockerfile run command create its own layer?</a></li>
                        <li><a href="https://blog.docker.com/2015/11/docker-multi-host-networking-ga/">What happened to Docker links?</a></li>
                    </ul>
                </section>
                <section>
                    <h3>FAQ</h3>
                    <p>Q: Whats the story with docker top pids?</p>
                    <pre><code data-trim contenteditable>
$ sudo docker top sleepy_cori
UID  PID   PPID C STIME TTY    TIME     CMD
root 30136 2379 0 12:29 pts/32 00:00:00 /bin/bash

$ pstree -s -p $(sudo docker top sleepy_cori | tail -1 | awk '{ print $2 }')
init(1)───docker(2379)───bash(30136)
                    </code></pre>
                    <p>A: Top pids are host pids not namespaces container pids</p>
                </section>
                <section>
                    <h3>FAQ</h3>
                    <p>Q: Should I include my application source code in the image?</p>
                    <p>A: It depends, some people like to mount application source code as <a href-"http://blog.ionic.io/docker-hot-code-deploys/">volume</a>, other checkout source code when <a href="http://michal.karzynski.pl/blog/2015/04/19/packaging-django-applications-as-docker-container-images/">building the image</a>.</p>
                    <p>If you are checking out source code in your Dockerfile you need to be aware of <a href="http://thenewstack.io/understanding-the-docker-cache-for-faster-builds/">how caching works</a>.</p>
                </section>
                <section>
                    <h3>FAQ: Copy vs. Add</h3>
                    <p>A: Should I use Copy or Add in my Dockerfile?</p>
                    <p>Q: Use copy unless you actually need the magic add provides (details <a href="https://labs.ctl.io/dockerfile-add-vs-copy/">here</a>).</p>
                </section>
                </section>

                <section>
                <section>
                    <h3>Next steps</h3>
                    <p>What would you like to see in an intermediate docker course?</p>
                </section>
                <section>
                    <h3>Next steps</h3>
                    <ul>
                        <li>Setup private registry</li>
                        <li>Students build custom "microservices"</li>
                        <li>Setup CoreOS on OpenStack</li>
                        <li>Deploy students microservices and create a www router service</li>
                        <li>Define service as a kubernetes pod</li>
                        <li>Scale and migrate pods (between OpenStack regions?)</li>
                        <li>Continuous delivery?</li>
                        <li>Let me know!</li>
                    </ul>
                </section>
                </section>

                <section>
                    <h3>Sources</h3>
                    <p>Sources of the material used in this course:</p>
                    <ul>
                        <li><a href="https://docs.docker.com/">https://docs.docker.com/</a></li>
                        <li><a href="https://training.docker.com/introduction-to-docker">https://training.docker.com/introduction-to-docker</a></li>
                        <li><a href="http://alandargan.com/using-vagrant-docker/">http://alandargan.com/using-vagrant-docker/</a></li>
                        <li><a href="http://blog.octo.com/en/docker-registry-first-steps/">http://blog.octo.com/en/docker-registry-first-steps/</a></li>
                        <li><a href="https://www.digitalocean.com/community/tutorials/the-docker-ecosystem-an-introduction-to-common-components">https://www.digitalocean.com/community/tutorials/the-docker-ecosystem-an-introduction-to-common-components</a></li>
                        <li><a href="http://radar.oreilly.com/2015/07/set-up-kubernetes-with-a-docker-compose-one-liner.html">http://radar.oreilly.com/2015/07/set-up-kubernetes-with-a-docker-compose-one-liner.html</a></li>
                        <li><a href="http://www.linuxjournal.com/content/concerning-containers-connections-docker-networking">http://www.linuxjournal.com/content/concerning-containers-connections-docker-networking</a></li>
                    </ul>

                </section>
        </div>


        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

                // Parallax scrolling
                // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
                // parallaxBackgroundSize: '2100px 900px',

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

        </script>

    </body>
</html>
